function createDistList(){showStatus("Creating List...",false,function(){var a=$("#dist_create_table input:checked").parent().parent();var b=[];for(var d=0;d<a.length;d++){b.push(a[d].id)}var c=$("#dist_name").val();var e=$("#dist_expire").val();$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",data:{cls:"DistributionList",fn:"create",params:[c,e,b]},async:true,success:function(g){var f=function(h){window.location=uri+"/distribution?dl_id="+h};if(g!=-1){showStatus("Success!",false,function(){f(g)})}else{showStatus("ERROR creating distribution list!")}},error:function(f){showStatus("ERROR creating distribution list.")}})})}function saveDistList(){showStatus("Saving List...",false,function(){var b=$("#dist_create_table input").not(":checked").parent().parent();var a=[];for(var d=0;d<b.length;d++){a.push(b[d].id)}var b=$("#dist_create_table input:checked").parent().parent();var g=[];for(var d=0;d<b.length;d++){g.push(b[d].id)}if(g.length==0){g=-1}if(a.length==0){a=-1}var f=$("#dist_list_id").val();var c=$("#dist_name").val();var e=$("#dist_expire").val();$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",data:{cls:"DistributionList",fn:"alter",params:[f,c,e,a,g]},async:true,success:function(h){if(h!=-1){showStatus("Success!")}else{showStatus("ERROR altering distribution list!")}},error:function(h){showStatus("ERROR altering distribution list.")}})})}function rankChange(){var b=function(f){var c=$(f).parent().parent()[0].id;var g=$(f).val();var e=$("#distribution_books select");for(var d=0;d<e.length;d++){if($(e[d]).val()==g&&f!=e[d]){$(e[d]).val("--")}}$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",data:{cls:"DistributionListPreference",fn:"updatePreferences",params:[distribution_list_id,c,g]},async:true,success:function(h){procReturn(h);showStatus("Selections Saved!",4000)},error:function(h){showStatus("ERROR updating rank.")}})};var a=this;showStatus("Updating Selections...",false,function(){b(a)})}function assignBook(assign,distribution_list_preference_id,dlp_array){if(typeof dlp_array!="undefined"){var dlb=$.ajax({url:uri+"/svc/read",type:"GET",dataType:"json",async:false,data:{cls:"DistributionListBook",query:[["book_id",dlp_array.book_id],"AND",["distribution_list_id",dlp_array.distribution_list_id]]}});eval("var dlb = "+dlb.responseText);if(dlb.results.length!=0){dlb_id=dlb.results[0].distribution_list_book_id;var dlp=$.ajax({url:uri+"/svc/create",type:"POST",dataType:"json",async:false,data:{cls:"DistributionListPreference",data:{distribution_list_book_id:dlb_id,person_id:dlp_array.person_id,rank:null}}});eval("dlp = "+dlp.responseText);if(typeof dlp.distribution_list_preference_id!="undefined"){distribution_list_preference_id=dlp.distribution_list_preference_id}else{showStatus("ERROR: Assigning to Other AE Failed.(190)");return}}else{showStatus("ERROR: Assigning to Other AE Failed.(191");return}}var callback=function(assign,dlpid){$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",data:{fn:"assignBook",cls:"DistributionListPreference",params:[dlpid,assign]},async:true,success:function(ret){procReturn(ret);hideStatus()},error:function(err,textStatus,errorThrow){showStatus("ERROR assigning book.");console.log(err,textStatus,errorThrow)}})};statusText="Assigning...";if(!assign){statusText="Unassigning..."}showStatus(statusText,false,function(){callback(assign,distribution_list_preference_id)})}function showHistory(a){var b=function(c){$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",data:{cls:"DistributionList",fn:"getPersonHistory",params:[c]},success:function(d){procReturn(d);hideStatus()}})};showStatus("Loading",false,function(){b(a)})}function distHistSort(c,d){var a=(!$(d).hasClass("headerSortDown"))?0:1;var b=0;if(d.indexOf("pend")!=-1){b=0}else{if(d.indexOf("rank")!=-1){b=1}else{if(d.indexOf("promised")!=-1){b=2}else{if(d.indexOf("title")!=-1){b=3}}}}$("table.dist_header  td").css("fontWeight","");$(c).css("fontWeight","bold");$("table.dist_hist").trigger("sorton",[[[b,a]]])}function sortDL(b){var a;if(b=="active"){$("#sort_by_active").css("font-weight","bold");$("#sort_by_name").css("font-weight","normal");$("#sort_by_created").css("font-weight","normal");$("#sort_by_expires").css("font-weight","normal");a=function(d,c){a_v=$("td > span",d).css("font-weight")=="bold";b_v=$("td > span",c).css("font-weight")=="bold";return a_v<b_v}}else{if(b=="name"){$("#sort_by_active").css("font-weight","normal");$("#sort_by_name").css("font-weight","bold");$("#sort_by_created").css("font-weight","normal");$("#sort_by_expires").css("font-weight","normal");a=function(d,c){a_v=$("td > span",d).html();b_v=$("td > span",c).html();return a_v>b_v}}else{if(b=="created"){$("#sort_by_active").css("font-weight","normal");$("#sort_by_name").css("font-weight","normal");$("#sort_by_created").css("font-weight","bold");$("#sort_by_expires").css("font-weight","normal");a=function(d,c){a_v=$("td input.created",d).val();b_v=$("td input.created",c).val();return a_v<b_v}}else{if(b=="expires"){$("#sort_by_active").css("font-weight","normal");$("#sort_by_name").css("font-weight","normal");$("#sort_by_created").css("font-weight","normal");$("#sort_by_expires").css("font-weight","bold");a=function(d,c){a_v=$("td input.expires",d).val();b_v=$("td input.expires",c).val();return a_v<b_v}}else{return}}}}$(".dist_list_row").sort(a).appendTo("#dist_list_holder")}function howToSaveMsg(){alert("Selections are automatically updated.\nNo need to click a save button!")}function toggleDLAct(a,b){var d;if(b){d="Activating..."}else{d="Deactivating..."}var c=function(e,f){$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",data:{cls:"DistributionList",fn:"activate",params:[e,f]},success:function(g){$(".dist_list_row > td > span").css("font-weight","normal");$(".manage_dl_deact").css("display","none");$(".manage_dl_act").css("display","");if(g){$("#dist_list_"+g+" >td > span").css("font-weight","bold");$("#deact_"+g).css("display","");$("#act_"+g).css("display","none");hideStatus()}else{showStatus("Activation failed.")}}})};showStatus(d,false,function(){c(a,b)})}function deactivateDistList(b){var a=function(c){$.ajax({url:uri+"/svc/update",type:"POST",dataType:"json",data:{cls:"DistributionList",id:c,data:{active:0}},success:function(d){if(d!=-1){showStatus("List Deactivated!",false);window.location.reload()}else{showStatus("ERROR: List Deactivation Failed!",5000)}},error:function(d){showStatus("ERROR: List Deactivation Failed!",5000)}})};showStatus("Deactivating List",false,function(){a(b)})}function toggleAllAEs(b,e,a){var d=$("#all_"+a+"_"+e);var c=b;var a=(a=="books")?"Books":"AEs";if($(d).css("display")=="none"){$(d).css("display","");$(c).html("Hide All "+a)}else{$(d).css("display","none");$(c).html("Show All "+a)}}jQuery.fn.sort=function(){return this.pushStack([].sort.apply(this,arguments),[])};