var filterTimeoutProc=false;function loadPerson(a){loadFunc=function(){clearInputs("#people_center input, #people_center textarea, #people_center select");$.ajax({url:uri+"/people/loadPerson",type:"GET",dataType:"json",data:{person_id:a},async:true,success:function(b){if(b!=-1){hideStatus();procReturn(b)}else{showStatus("Error on loading person.")}}})};showStatus("Loading...",false,loadFunc)}function addPerson(){showStatus("Creating Person",false,function(){var d=new Date();var res=$.ajax({url:uri+"/svc/create",type:"POST",dataType:"json",data:{cls:"Person",data:{last_name:"Person",first_name:"New",role_id:4,institution:"Enter an Institution",department:"Enter a Department"}},async:false});if(res!=-1){eval("res = "+res.responseText);showStatus("Person Created");loadPerson(res.person_id)}else{showStatus("Person Creation Failed.")}})}function savePerson(){saveFunc=function(){if($(".dirty_input.people").length!=0&&$("#person__person_id").val()){var c={id:$("#person__person_id").val(),cls:"person",data:{}};var b=$(".dirty_input.people");for(var a=0;a<b.length;a++){c.data[b[a].id.replace("person__","")]=$(b[a]).val()}$.ajax({url:uri+"/svc/update",type:"POST",dataType:"json",data:c,async:true,success:function(d){if(d!=-1){showStatus("Successfully Saved!")}else{showStatus("Error on saving person.")}}})}if($(".dirty_input.address").length!=0){if($("#address__address_id").val()){var c={id:$("#address__address_id").val(),cls:"address",data:{}};var b=$(".dirty_input.address");for(var a=0;a<b.length;a++){c.data[b[a].id.replace("address__","")]=$(b[a]).val()}$.ajax({url:uri+"/svc/update",type:"POST",dataType:"json",data:c,async:true,success:function(d){if(d!=-1){showStatus("Successfully Saved!")}else{showStatus("Error on saving address.")}}})}else{if($("#person__person_id").val()){var c={id:$("#address__address_id").val(),cls:"address",data:{person_id:$("#person__person_id").val()}};var b=$(".dirty_input.address");for(var a=0;a<b.length;a++){c.data[b[a].id.replace("address__","")]=$(b[a]).val()}$.ajax({url:uri+"/svc/create",type:"POST",dataType:"json",data:c,async:true,success:function(d){if(d!=-1){showStatus("Successfully Saved!")}else{showStatus("Error on creating address.")}}})}}}clearDirty("#people_center input,#people_center select,#people_center textarea")};showStatus("Saving...",false,saveFunc)}function changePassword(){var b=$("#change_password_table #password_1").val();var a=$("#change_password_table #password_2").val();if(b==a){$.ajax({url:uri+"/svc/update",type:"POST",dataType:"json",data:{cls:"person",id:$("#person__person_id").val(),data:{password:b}},async:true,success:function(c){$("#password_modal").fadeOut(500,function(){$("#password_modal_gray").remove();$("#password_modal").remove();$("#body").height(null);$("#body").css("overflow-y","auto")});if(c!=-1){showStatus("Password Changed!")}else{showStatus("Password change failed.")}}})}else{$("#change_password_message").html("Passwords do not match.")}}function filterPerson(){if(filterTimeoutProc!=false){clearTimeout(filterTimeoutProc)}filterTimeoutProc=setTimeout(execFilter,250)}function execFilter(){filterTimeoutProc=false;var b=$("#people_filter").val();if(b!=""){$("#people_list ul").html("");var e=b.split(" ");var c=[];for(var d in e){if(e[d]!=""){var a=[["first_name","like",e[d]+"%"],"OR",["last_name","like",e[d]+"%"]];c.push(a);c.push("AND")}}c.splice(c.length-1,1);$.ajax({url:uri+"/svc/read",type:"GET",dataType:"json",data:{cls:"person",query:c,select:["first_name","last_name"]},async:true,success:function(h){h=h.results;for(var f in h){r=h[f];li=document.createElement("li");li.id=r.person_id;var i=r.last_name+", "+r.first_name;var g=$("#people_filter").val();if(g!=""){var k=g.split(" ");for(var j in k){if(k[j]!=""){i=i.replace(k[j],"<strong>"+k[j]+"</strong>")}}}li.innerHTML=i;$(li).bind("click",function(){$("#people_list li").each(function(l,m){$(m).removeClass("selected")});$(this).addClass("selected");loadPerson(this.id)});$("#people_list ul").append(li)}}})}else{$("#people_list li").each(function(f,g){$(g).remove()})}}function passwordModal(){$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",data:{cls:"Person",fn:"getPasswordModal",params:[1]},success:function(a){procReturn(a)}})};