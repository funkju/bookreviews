var search_offset=0;var search_order="book_title";function loadReviewerContact(a){$.ajax({url:uri+"/svc/read",type:"GET",dataType:"json",data:{cls:"address",query:[["person_id",a]],select:"voice, email"},async:true,success:function(b){b=b.results;if(b.length>=1){b[0].voice=(!b[0].voice)?"---":b[0].voice;b[0].email=(!b[0].email)?"---":b[0].email;$("#reviewer__phone").html(b[0].voice);$("#reviewer__email").html(b[0].email)}else{$("#reviewer__phone").html("---");$("#reviewer__email").html("---")}},error:function(b){showStatus("Loading Reviewer Contact Failed.")}})}function loadAssocEditorContact(a){$.ajax({url:uri+"/svc/read",type:"GET",dataType:"json",data:{cls:"address",query:[["person_id",a]],select:"voice, email"},async:true,success:function(b){b=b.results;if(b.length>=1){b[0].voice=(!b[0].voice)?"---":b[0].voice;b[0].email=(!b[0].email)?"---":b[0].email;$("#assoc_ed__phone").html(b[0].voice);$("#assoc_ed__email").html(b[0].email)}else{$("#assoc_ed__phone").html("---");$("#assoc_ed__email").html("---")}},error:function(b){showStatus("Loading Assoc Editor Contact Failed.")}})}function createNewBookReview(){showStatus("Creating New Review...",false,function(){$.ajax({url:uri+"/svc/create",type:"POST",dataType:"json",data:{cls:"BookReview"},async:true,success:function(a){if(a!=-1){showStatus("Created Review!",false);window.location=uri+"/reviews/edit/"+a.book_review_id}else{showStatus("Review Creating Failed!")}},error:function(a){showStatus("Review Creating Failed!")}})})}function saveBookReview(){var a=$(".dirty_input");if(a.length!=0){showStatus("Saving...",false,function(){var c=$(".dirty_input");var d={};for(var b=0;b<c.length;b++){if($(c[b])[0].type=="checkbox"){d[c[b].id.replace("book_review__","")]=$(c[b]+":checked").val()}else{d[c[b].id.replace("book_review__","")]=$(c[b]).val()}}d.do_not_publish=(d.do_not_publish=="on")?1:0;delete (d.title);$.ajax({url:uri+"/svc/update",type:"POST",dataType:"json",data:{cls:"BookReview",id:$("#book_review__book_review_id").val(),data:d},async:true,success:function(e){if(e!=-1){showStatus("Updated!");clearDirty("input.reviews, select.reviews, textarea.reviews")}else{showStatus("Updating Book Review failed")}},error:function(e){showStatus("Updating Book Review failed")}})})}}function delBookReview(){showStatus("Deleting...",false,function(){var a=$("#book_review__book_review_id").val();$.ajax({url:uri+"/svc/delete",type:"POST",dataType:"json",data:{cls:"BookReview",id:a},async:true,success:function(b){if(b!=-1){showStatus("Deleted!");window.location=uri+"/reviews"}else{showStatus("Deleting Book Review Failed!")}},error:function(b){showStatus("Deleting Book Review Failed!")}})})}function searchReviews(b,a){if(typeof b!="undefined"){search_offset=b}if(typeof a!="undefined"){search_order=a}showStatus("Searching...",false,function(){var d=$("#reviews_search >  input[type=text]").val();var c=$("#reviews_search > select").val();if(d!=""){$.ajax({url:uri+"/reviews/searchReviews",type:"GET",dataType:"json",data:{query:d,limit:25,offset:search_offset,order:search_order,search:c},async:true,success:function(e){procReturn(e);hideStatus()},error:function(e){showStatus("Finding Reviews failed.")}})}})}function showPending(b){$("#review_message").hide();if($("#reviews_list > div.show").length!=0&&$("#reviews_list > div.show")[0].id=="right_"+b){return}if($("#reviews_list > div.show").id=="right_"+b){return}$("div.reviews_pending_name.show").css("font-weight","normal").removeClass("show");$("#left_"+b).css("font-weight","bold").addClass("show");var a=function(c){$("#right_"+c).fadeIn();$("#right_"+c).addClass("show");$.cookie("show_ae",c)};if($("#reviews_list > div.show").length!=0){$("#reviews_list > div.show").fadeOut(function(){$(this).removeClass("show");a(b)})}else{a(b)}}function sortPendingReviews(b){var a;if(b=="name"){$("#sort_by_name").css("font-weight","bold");$("#sort_by_count").css("font-weight","normal");a=function(d,c){return $("span.name",d).html()>$("span.name",c).html()?1:-1}}else{if(b=="count"){$("#sort_by_name").css("font-weight","normal");$("#sort_by_count").css("font-weight","bold");a=function(d,c){var f=parseInt($("span.count",d).html().replace("(","").replace(")",""));var e=parseInt($("span.count",c).html().replace("(","").replace(")",""));return f<e?1:-1}}else{return}}$(".reviews_pending_name").sort(a).appendTo("#ae_list_holder")}function fillMonths(){$("#month_spinner").css("display","");$("#month").css("display","none");$("#reviews_by_issue").css("display","none");var b=$("#seljournal").val();if(b==""){return}var c=$("#selyear").val();if(c==""){return}var a=["January","Febuary","March","April","May","June","July","August","September","October","November","December"];$.ajax({url:uri+"/svc/read",type:"GET",dataType:"json",async:true,data:{cls:"BookReview",select:"issue_month",distinct:true,order:"issue_month ASC",query:[["journal_id",b],"AND",["issue_year",c],"AND",["issue_month",">",0]]},success:function(d){$("#selmonth").children().remove();$("#selmonth").append("<option value=''>----</option>");if(d!=-1){for(var e=0;e<d.results.length;e++){mon=d.results[e];$("#selmonth").append("<option value="+mon.issue_month+">"+a[mon.issue_month-1]+"</option>")}}$("#month").css("display","");$("#month_spinner").css("display","none")}})}function fillYears(){$("#year_spinner").css("display","");$("#year").css("display","none");$("#month").css("display","none");$("#month_spinner").css("display","none");$("#reviews_by_issue").css("display","none");var a=$("#seljournal").val();if(a==""){return}$.ajax({url:uri+"/svc/read",type:"GET",dataType:"json",async:"true",data:{cls:"BookReview",select:"issue_year",distinct:true,order:"issue_year ASC",query:[["journal_id",a],"AND",["issue_year",">",0]]},success:function(b){$("#selyear").children().remove();$("#selyear").append("<option value=''>----</option");if(b!=-1){for(var c=0;c<b.results.length;c++){yr=b.results[c];$("#selyear").append("<option>"+yr.issue_year+"</option")}}$("#year").css("display","");$("#year_spinner").css("display","none")}})}function getReviewsByIssue(){$("#content_spinner").css("display","");$("#reviews_by_issue").css("display","none");var b=$("#selmonth").val();$.cookie("rev_by_issue_month",b);if(b==""){$("#year").css("display","none");return}var a=$("#seljournal").val();$.cookie("rev_by_issue_journal_id",a);if(a==""){return}var c=$("#selyear").val();$.cookie("rev_by_issue_year",c);if(c==""){return}$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",async:"true",data:{cls:"BookReview",fn:"getReviewsByIssue",params:[a,b,c]},success:function(d){if(d!=-1){procReturn(d);$("#reviews_by_issue").css("display","");$("#content_spinner").css("display","none")}}})}function getOrderToPublish(){$("#order_to_publish").css("display","");$("#content_spinner").css("display","none");var c=$.cookie("rev_by_issue_month");var b=$.cookie("rev_by_issue_year");var a=$.cookie("rev_by_issue_journal_id");if(c==""||b==""||a==""){return}$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",async:"true",data:{cls:"BookReview",fn:"getOrderToPublishList",params:[a,c,b]},success:function(d){if(d!=-1){procReturn(d);$("#order_to_publish").css("display","");$("#content_spinner").css("display","none")}}})}function getAuthorInformation(){$("#author_information").css("display","");$("#content_spinner").css("display","none");var c=$.cookie("rev_by_issue_month");var b=$.cookie("rev_by_issue_year");var a=$.cookie("rev_by_issue_journal_id");if(c==""||b==""||a==""){return}$.ajax({url:uri+"/svc/call",type:"GET",dataType:"json",async:"true",data:{cls:"BookReview",fn:"getAuthorInformationList",params:[a,c,b]},success:function(d){if(d!=-1){procReturn(d);$("#author_information").css("display","");$("#content_spinner").css("display","none")}}})}function cleanReviewsByIssueSelects(){var c=$("#selmonth").val();var b=$("#seljournal").val();var d=$("#selyear").val();if(c==""||b==""||d==""){return}var a=["January","Febuary","March","April","May","June","July","August","September","October","November","December"];$.ajax({url:uri+"/svc/read",type:"GET",dataType:"json",async:"true",data:{cls:"BookReview",select:"issue_year",distinct:true,order:"issue_year ASC",query:[["journal_id",b],"AND",["issue_year",">",0]]},success:function(e){var g=$("#selyear").val();$("#selyear").children().remove();$("#selyear").append("<option value=''>----</option");if(e!=-1){for(var f=0;f<e.results.length;f++){yr=e.results[f];$("#selyear").append("<option>"+yr.issue_year+"</option")}}$("#selyear").val(g)}});$.ajax({url:uri+"/svc/read",type:"GET",dataType:"json",async:true,data:{cls:"BookReview",select:"issue_month",distinct:true,order:"issue_month ASC",query:[["journal_id",b],"AND",["issue_year",d],"AND",["issue_month",">",0]]},success:function(f){var e=$("#selmonth").val();$("#selmonth").children().remove();$("#selmonth").append("<option value=''>----</option>");if(f!=-1){for(var g=0;g<f.results.length;g++){mon=f.results[g];$("#selmonth").append("<option value="+mon.issue_month+">"+a[mon.issue_month-1]+"</option>")}}$("#selmonth").val(e)}})}function changePubOrder(e){var b=$(e).val();var d=$(e).parent().parent().attr("id").replace("review_id_","");if(b!=""){var a=$("select.publish_order");for(var c=0;c<a.length;c++){if($(a[c]).val()==b&&a[c]!=e){$(a[c]).val("");changePubOrder(a[c])}}}$.ajax({url:uri+"/svc/update",type:"POST",dataType:"json",async:"true",data:{cls:"BookReview",id:d,data:{publish_order:b}},success:function(f){if(f!=-1){showStatus("Order Saved...")}else{showStatus("Saving Order Failed!",5000)}}})}function deleteAttach(b){var a=confirm("Delete This Attachment?");if(a){$("tr#attach_"+b).addClass("delete_attach");showStatus("Deleting...",false,function(){$.ajax({url:uri+"/svc/delete",type:"POST",dataType:"json",async:"true",data:{cls:"BookReviewAttachment",id:b},success:function(c){if(c!=-1){showStatus("Attachment Deleted...");$("tr.delete_attach").remove()}else{showStatus("Deleting Attachment Failed")}}})})}}jQuery.fn.sort=function(){return this.pushStack([].sort.apply(this,arguments),[])};